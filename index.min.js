function HTMLEscape(e){const t=document.createElement("pre");return t.innerText=e,t.innerHTML}function notify(e){Swal.fire({animation:!1,text:e,confirmButtonText:"確定"})}function notifyHTML(e){Swal.fire({animation:!1,html:e,confirmButtonText:"確定"})}function notifyErrorWithoutStack(e){const t=`<p lang="en">Error: ${HTMLEscape(e.message)}</p>`;Swal.fire({animation:!1,icon:"error",html:t,confirmButtonText:"確定"})}function notifyError(e){let t=`<p lang="en">Error: ${HTMLEscape(e.message)}</p>`;e.stack&&(t+=`<pre lang="en" style="text-align: left;">${HTMLEscape(e.stack)}</pre>`),Swal.fire({animation:!1,icon:"error",html:t,confirmButtonText:"確定"})}function notifyErrorWithError(e,t){let n=`<p>音韻地位：<span lang="en">${e}, Error: ${HTMLEscape(t.message)}</span></p>`;t.stack&&(n+=`<pre lang="en" style="text-align: left;">${HTMLEscape(t.stack)}</pre>`),Swal.fire({animation:!1,icon:"error",html:n,confirmButtonText:"確定"})}function copyTextToClipboard(e){if(null==navigator.clipboard){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")?notify("已成功匯出至剪貼簿"):notifyErrorWithoutStack(new Error("匯出至剪貼簿失敗"))}catch(e){notifyError(e)}document.body.removeChild(t)}else navigator.clipboard.writeText(e).then((()=>notify("已成功匯出至剪貼簿")),(e=>notifyError(e)))}let schemaInputArea;function handleLoadSchema(e){fetch(`https://cdn.jsdelivr.net/gh/nk2028/qieyun-examples@336f2eb/${e}.js`).then((e=>e.text())).then((e=>schemaInputArea.setValue(e))).catch((e=>notifyError(e)))}function 音韻描述2音韻地位(e){const t=/(.)(.)(.)([AB]?)(.)(.)/gu.exec(e);return new Qieyun.音韻地位(t[1],t[2],t[3],t[4]||null,t[5],t[6])}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("schemaInput");schemaInputArea=CodeMirror(e,{mode:"javascript",lineNumbers:!0});handleLoadSchema(document.forms.schemaSelect.schema.value)}));const 音韻描述2小韻號Map=new Map;for(let e=3874;e>=1;e--)音韻描述2小韻號Map.set(Qieyun.get音韻地位(e).音韻描述,e);function 音韻描述2小韻號(e){return 音韻描述2小韻號Map.get(e)}let userInput;function loadSchema(){try{userInput=new Function("音韻地位","小韻號","字頭",schemaInputArea.getValue())}catch(e){throw notifyError(e),e}}function 推導(e,t,n){try{const o=userInput(e,t,n);if(null==o)throw new Error("Result is null");return o}catch(t){throw notifyErrorWithError(e.音韻描述,t),t}}function makeTooltip(e,t){const n=document.createElement("span");n.classList.add("tooltip-item");const o=document.createElement("span");o.lang="och-Latn-fonipa",o.innerText=e,n.appendChild(o),n.appendChild(document.createTextNode(" "));for(const[e,{"字頭":o,"小韻號":a,"解釋":r,"音韻地位":l}]of t.entries()){0!==e&&n.appendChild(document.createElement("br"));let t=Qieyun.get反切(a);t=null==t?"":`${t} `;const c=document.createElement("span");c.classList.add("tooltip-ch"),c.innerText=o,n.appendChild(c),n.appendChild(document.createTextNode(" ")),n.appendChild(document.createTextNode(`${l.音韻描述} ${t}${r}`))}return n}function makeNoneEntry(e){const t=document.createElement("span");return t.classList.add("entry"),t.classList.add("entry-none"),t.appendChild(document.createTextNode(e)),t.handleExport=()=>e,t.handleRuby=()=>e,t}function makeSingleEntry(e,t){const[n,o]=[...t][0],a=document.createElement("span");a.classList.add("entry"),a.classList.add("entry-single");const r=document.createElement("ruby");r.appendChild(document.createTextNode(e));const l=document.createElement("span");l.classList.add("tooltip-container");const c=document.createElement("rp");c.appendChild(document.createTextNode("(")),r.appendChild(c);const d=document.createElement("rt");d.lang="och-Latn-fonipa",d.innerText=n,r.appendChild(d);const i=document.createElement("rp");i.appendChild(document.createTextNode(")")),r.appendChild(i);const s=makeTooltip(n,o);l.appendChild(s),a.appendChild(r),a.appendChild(l);const u=`${e}(${n})`;a.handleExport=()=>u;const p=`<ruby>${e}<rt>${n}</rt></ruby>`;return a.handleRuby=()=>p,a}function makeMultipleEntry(e,t){const n=document.createElement("span");n.classList.add("entry"),n.classList.add("entry-multiple"),n.classList.add("unresolved");const o=document.createElement("ruby");o.appendChild(document.createTextNode(e));const a=document.createElement("span");a.classList.add("tooltip-container");const r=document.createElement("rp");r.appendChild(document.createTextNode("(")),o.appendChild(r);const l=document.createElement("rt");l.lang="och-Latn-fonipa",o.appendChild(l);const c=document.createElement("rp");c.appendChild(document.createTextNode(")")),o.appendChild(c);const d=[],i=[];for(const[e,[o,r]]of[...t].entries()){const t=document.createElement("span");t.innerText=o,l.appendChild(t),d.push(t);const c=makeTooltip(o,r);c.addEventListener("click",(()=>{d.map((e=>e.classList.add("hidden"))),t.classList.remove("hidden"),n.currentSelection=o,n.classList.remove("unresolved"),i.map((e=>e.classList.remove("selected"))),c.classList.add("selected")})),a.appendChild(c),i.push(c),0===e?(n.currentSelection=o,c.classList.add("selected")):t.classList.add("hidden")}return n.appendChild(o),n.appendChild(a),n.handleExport=()=>`${e}(${n.currentSelection})`,n.handleRuby=()=>`<ruby>${e}<rt>${n.currentSelection}</rt></ruby>`,n}function makeConversion(e){const t=Yitizi.get(e);t.unshift(e);const n=new Map;for(const e of t)for(const{"小韻號":t,"解釋":o}of Qieyun.query漢字(e)){const a=Qieyun.get音韻地位(t),r=推導(a,t,e);null==n.get(r)&&n.set(r,[]),n.get(r).push({"字頭":e,"小韻號":t,"解釋":o,"音韻地位":a})}switch(n.size){case 0:return makeNoneEntry(e);case 1:return makeSingleEntry(e,n);default:return makeMultipleEntry(e,n)}}function handleConvertArticle(){const e=document.getElementById("outputArea"),t=document.getElementById("articleInput");e.innerHTML="";const n=document.createDocumentFragment();for(const e of t.value)n.appendChild(makeConversion(e));e.appendChild(n),e.handleExport=()=>[...e.childNodes].map((e=>e.handleExport())).join(""),e.handleRuby=()=>[...e.childNodes].map((e=>e.handleRuby())).join("")}function handleConvertPresetArticle(){fetch("https://cdn.jsdelivr.net/gh/nk2028/qieyun-text-label@7350432/index.html").then((e=>e.text())).then((e=>function(e){const t=document.getElementById("outputArea");t.innerHTML="";const{body:n}=(new DOMParser).parseFromString(e,"text/html");n.querySelectorAll("ruby").forEach((e=>{const t=e.querySelector("rt"),n=e.childNodes[0].textContent,o=t.innerText,a=推導(音韻描述2音韻地位(o),音韻描述2小韻號(o),n);t.lang="och-Latn-fonipa",t.innerText=a})),n.querySelectorAll("h1").forEach((e=>{const t=document.createElement("h3");t.innerHTML=e.innerHTML,e.parentNode.replaceChild(t,e)}));const o=document.createDocumentFragment();n.childNodes.forEach((e=>{o.appendChild(e)})),t.appendChild(o),t.handleExport=null,t.handleRuby=null}(e))).catch((e=>notifyError(e)))}function handleExportAllSmallRhymes(){const e=document.getElementById("outputArea");e.innerHTML="";const t=document.createDocumentFragment();for(let e=1;e<=3874;e++){const n=Qieyun.get音韻地位(e),o=`${n.音韻描述} `,a=推導(n,e,null);t.appendChild(document.createTextNode(o));const r=document.createElement("span");r.lang="och-Latn-fonipa",r.appendChild(document.createTextNode(a)),t.appendChild(r),t.appendChild(document.createElement("br"))}e.appendChild(t),e.handleExport=null,e.handleRuby=null}function handleExportAllSyllables(){const e=document.getElementById("outputArea");e.innerHTML="";const t=document.createElement("span");t.lang="och-Latn-fonipa";const n=new Set;for(let e=1;e<=3874;e++){const t=推導(Qieyun.get音韻地位(e),e,null);n.add(t)}t.innerText=[...n].join(", "),e.appendChild(t),e.handleExport=null,e.handleRuby=null}function handleExportAllSyllablesWithCount(){const e=document.getElementById("outputArea");e.innerHTML="";const t=document.createElement("span");t.lang="och-Latn-fonipa";const n=new Map;for(let e=1;e<=3874;e++){const t=推導(Qieyun.get音韻地位(e),e,null),o=n.get(t);n.set(t,null==o?1:o+1)}const o=[...n];o.sort(((e,t)=>t[1]-e[1])),t.innerText=o.map((([e,t])=>`${e} (${t})`)).join(", "),e.appendChild(t),e.handleExport=null,e.handleRuby=null}function handlePredefinedOptions(){switch(loadSchema(),document.getElementById("predefinedOptions").value){case"convertArticle":handleConvertArticle();break;case"convertPresetArticle":handleConvertPresetArticle();break;case"exportAllSmallRhymes":handleExportAllSmallRhymes();break;case"exportAllSyllables":handleExportAllSyllables();break;case"exportAllSyllablesWithCount":handleExportAllSyllablesWithCount()}}function handleCopy(){const e=document.getElementById("outputArea"),t=e.handleExport?e.handleExport():e.innerText;t?copyTextToClipboard(t):notifyErrorWithoutStack(new Error("請先進行操作，再匯出結果"))}function handleRuby(){const e=document.getElementById("outputArea"),t=e.handleRuby?e.handleRuby():e.innerText;t?copyTextToClipboard(t):notifyErrorWithoutStack(new Error("請先進行操作，再匯出結果"))}function showPrivacy(){notifyHTML('<div style="text-align: initial;">\n<h1>私隱權政策</h1>\n<p>《切韻》音系自動推導器（下稱「本頁面」）是一項開放原始碼的網絡服務。作為本頁面的開發者，我們對閣下的私隱非常重視。本頁面的開發者不會透過本頁面收集閣下的任何資料。</p>\n<p>下面將具體介紹本頁面能在何種程度上保障閣下的私隱權。</p>\n<h2>閣下鍵入的內容</h2>\n<p>本頁面的開發者不會收集閣下在本頁面中鍵入的任何內容。任何與閣下鍵入的內容相關的運算均在閣下的系統本地完成。本頁面不會將包括待標註的文本、標註結果在內的任何資料傳送至任何伺服器。</p>\n<h2>閣下的其他資料</h2>\n<p>本頁面使用的內容託管於以下站點：GitHub Pages、jsDelivr、Google Fonts、cdnjs。在閣下訪問本頁面時，閣下的瀏覽器將與這些站點交互。本頁面的開發者並不能讀取閣下訪問這些站點時產生的資料，亦無法控制這些站點如何使用閣下訪問時產生的資料。<p>\n</div>')}
//# sourceMappingURL=index.min.js.map