function HTMLEscape(e){const t=document.createElement("pre");return t.innerText=e,t.innerHTML}function notify(e){Swal.fire({animation:!1,text:e,confirmButtonText:"確定"})}function notifyHTML(e){Swal.fire({animation:!1,html:e,confirmButtonText:"確定"})}function notifyErrorWithoutStack(e){const t=`<p lang="en">Error: ${HTMLEscape(e.message)}</p>`;Swal.fire({animation:!1,icon:"error",html:t,confirmButtonText:"確定"})}function notifyError(e){let t=`<p lang="en">Error: ${HTMLEscape(e.message)}</p>`;e.stack&&(t+=`<pre lang="en" style="text-align: left;">${HTMLEscape(e.stack)}</pre>`),Swal.fire({animation:!1,icon:"error",html:t,confirmButtonText:"確定"})}function notifyErrorWithError(e,t){let n=`<p>${e}, Error: ${HTMLEscape(t.message)}</p>`;t.stack&&(n+=`<pre lang="en" style="text-align: left;">${HTMLEscape(t.stack)}</pre>`),Swal.fire({animation:!1,icon:"error",html:n,confirmButtonText:"確定"})}function copyTextToClipboard(e){if(null==navigator.clipboard){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")?notify("已成功匯出至剪貼簿"):notifyErrorWithoutStack(new Error("匯出至剪貼簿失敗"))}catch(e){notifyError(e)}document.body.removeChild(t)}else navigator.clipboard.writeText(e).then((()=>notify("已成功匯出至剪貼簿")),(e=>notifyError(e)))}let schemaInputArea,userInput;function handleLoadSchema(e){fetch(`https://cdn.jsdelivr.net/gh/nk2028/qieyun-examples@336f2eb/${e}.js`).then((e=>e.text())).then((e=>schemaInputArea.setValue(e))).catch((e=>notifyError(e)))}function loadSchema(){try{userInput=new Function("音韻地位","字頭",schemaInputArea.getValue())}catch(e){throw notifyError(e),e}}function 推導(e,t){try{const n=userInput(e,t);if(null==n)throw new Error("Result is null");return n}catch(t){throw notifyErrorWithError(`音韻地位：${e.描述}`,t),t}}function makeTooltip(e,t){const n=document.createElement("span");n.classList.add("tooltip-item");const o=document.createElement("span");o.lang="och-Latn-fonipa",o.innerText=e,n.appendChild(o),n.appendChild(document.createTextNode(" "));for(const[e,{"字頭":o,"解釋":r,"音韻地位":a}]of t.entries()){0!==e&&n.appendChild(document.createElement("br"));let t=a.反切(o);t=null==t?"":`${t}切 `;const c=document.createElement("span");c.classList.add("tooltip-ch"),c.innerText=o,n.appendChild(c),n.appendChild(document.createTextNode(" ")),n.appendChild(document.createTextNode(`${a.描述} ${t}${r}`))}return n}function makeNoneEntry(e){const t=document.createElement("span");return t.classList.add("entry"),t.classList.add("entry-none"),t.appendChild(document.createTextNode(e)),t.handleExport=()=>e,t.handleRuby=()=>e,t}function makeSingleEntry(e,t){const[n,o]=[...t][0],r=document.createElement("span");r.classList.add("entry"),r.classList.add("entry-single");const a=document.createElement("ruby");a.appendChild(document.createTextNode(e));const c=document.createElement("span");c.classList.add("tooltip-container");const l=document.createElement("rp");l.appendChild(document.createTextNode("(")),a.appendChild(l);const d=document.createElement("rt");d.lang="och-Latn-fonipa",d.innerText=n,a.appendChild(d);const i=document.createElement("rp");i.appendChild(document.createTextNode(")")),a.appendChild(i);const s=makeTooltip(n,o);c.appendChild(s),r.appendChild(a),r.appendChild(c);const p=`${e}(${n})`;r.handleExport=()=>p;const u=`<ruby>${e}<rt>${n}</rt></ruby>`;return r.handleRuby=()=>u,r}function makeMultipleEntry(e,t){const n=document.createElement("span");n.classList.add("entry"),n.classList.add("entry-multiple"),n.classList.add("unresolved");const o=document.createElement("ruby");o.appendChild(document.createTextNode(e));const r=document.createElement("span");r.classList.add("tooltip-container");const a=document.createElement("rp");a.appendChild(document.createTextNode("(")),o.appendChild(a);const c=document.createElement("rt");c.lang="och-Latn-fonipa",o.appendChild(c);const l=document.createElement("rp");l.appendChild(document.createTextNode(")")),o.appendChild(l);const d=[],i=[];for(const[e,[o,a]]of[...t].entries()){const t=document.createElement("span");t.innerText=o,c.appendChild(t),d.push(t);const l=makeTooltip(o,a);l.addEventListener("click",(()=>{d.map((e=>e.classList.add("hidden"))),t.classList.remove("hidden"),n.currentSelection=o,n.classList.remove("unresolved"),i.map((e=>e.classList.remove("selected"))),l.classList.add("selected")})),r.appendChild(l),i.push(l),0===e?(n.currentSelection=o,l.classList.add("selected")):t.classList.add("hidden")}return n.appendChild(o),n.appendChild(r),n.handleExport=()=>`${e}(${n.currentSelection})`,n.handleRuby=()=>`<ruby>${e}<rt>${n.currentSelection}</rt></ruby>`,n}function makeConversion(e,t){let n;t?(n=Yitizi.get(e),n.unshift(e)):n=[e];const o=new Map;for(const e of n)for(const{"音韻地位":t,"解釋":n}of Qieyun.query字頭(e)){const r=推導(t,e);null==o.get(r)&&o.set(r,[]),o.get(r).push({"字頭":e,"解釋":n,"音韻地位":t})}switch(o.size){case 0:return makeNoneEntry(e);case 1:return makeSingleEntry(e,o);default:return makeMultipleEntry(e,o)}}function handleConvertArticle(e){const t=document.getElementById("outputArea"),n=document.getElementById("articleInput");t.innerHTML="";const o=document.createDocumentFragment();for(const t of n.value)o.appendChild(makeConversion(t,e));t.appendChild(o),t.handleExport=()=>[...t.childNodes].map((e=>e.handleExport())).join(""),t.handleRuby=()=>[...t.childNodes].map((e=>e.handleRuby())).join("")}function handleConvertPresetArticle(){fetch("https://cdn.jsdelivr.net/gh/nk2028/qieyun-text-label@1150f08/index.html").then((e=>e.text())).then((e=>function(e){const t=document.getElementById("outputArea");t.innerHTML="";const{body:n}=(new DOMParser).parseFromString(e,"text/html");n.querySelectorAll("ruby").forEach((e=>{const t=e.querySelector("rt"),n=e.childNodes[0].textContent,o=t.innerText,r=推導(Qieyun.音韻地位.from描述(o),n);t.lang="och-Latn-fonipa",t.innerText=r})),n.querySelectorAll("h1").forEach((e=>{const t=document.createElement("h3");t.innerHTML=e.innerHTML,e.parentNode.replaceChild(t,e)}));const o=document.createDocumentFragment();n.childNodes.forEach((e=>{o.appendChild(e)})),t.appendChild(o),t.handleExport=null,t.handleRuby=null}(e))).catch((e=>notifyError(e)))}function handleExportAllSmallRhymes(){const e=document.getElementById("outputArea");e.innerHTML="";const t=document.createDocumentFragment();for(const e of Qieyun.iter音韻地位()){const{"描述":n,"代表字":o}=e;t.appendChild(document.createTextNode(`${n} `));const r=document.createElement("span");r.lang="och-Latn-fonipa",r.appendChild(document.createTextNode(推導(e,null))),t.appendChild(r),t.appendChild(document.createTextNode(` ${o}`)),t.appendChild(document.createElement("br"))}e.appendChild(t),e.handleExport=null,e.handleRuby=null}function handleExportAllSyllables(){const e=document.getElementById("outputArea");e.innerHTML="";const t=document.createElement("span");t.lang="och-Latn-fonipa";const n=new Set;for(const e of Qieyun.iter音韻地位()){const t=推導(e,null);n.add(t)}t.innerText=[...n].join(", "),e.appendChild(t),e.handleExport=null,e.handleRuby=null}function handleExportAllSyllablesWithCount(){const e=document.getElementById("outputArea");e.innerHTML="";const t=document.createElement("span");t.lang="och-Latn-fonipa";const n=new Map;for(const e of Qieyun.iter音韻地位()){const t=推導(e,null),o=n.get(t);n.set(t,null==o?1:o+1)}const o=[...n];o.sort(((e,t)=>t[1]-e[1])),t.innerText=o.map((([e,t])=>`${e} (${t})`)).join(", "),e.appendChild(t),e.handleExport=null,e.handleRuby=null}function handlePredefinedOptions(){switch(loadSchema(),document.getElementById("predefinedOptions").value){case"convertArticle":handleConvertArticle(!1);break;case"convertArticleWithYitiziConvert":handleConvertArticle(!0);break;case"convertPresetArticle":handleConvertPresetArticle();break;case"exportAllSmallRhymes":handleExportAllSmallRhymes();break;case"exportAllSyllables":handleExportAllSyllables();break;case"exportAllSyllablesWithCount":handleExportAllSyllablesWithCount()}}function handleCopy(){const e=document.getElementById("outputArea"),t=e.handleExport?e.handleExport():e.innerText;t?copyTextToClipboard(t):notifyErrorWithoutStack(new Error("請先進行操作，再匯出結果"))}function handleRuby(){const e=document.getElementById("outputArea"),t=e.handleRuby?e.handleRuby():e.innerText;t?copyTextToClipboard(t):notifyErrorWithoutStack(new Error("請先進行操作，再匯出結果"))}function showPrivacy(){notifyHTML('<div style="text-align: initial;">\n<h1>私隱權政策</h1>\n<p>《切韻》音系自動推導器（下稱「本頁面」）是一項開放原始碼的網絡服務。作為本頁面的開發者，我們對閣下的私隱非常重視。本頁面的開發者不會透過本頁面收集閣下的任何資料。</p>\n<p>下面將具體介紹本頁面能在何種程度上保障閣下的私隱權。</p>\n<h2>閣下鍵入的內容</h2>\n<p>本頁面的開發者不會收集閣下在本頁面中鍵入的任何內容。任何與閣下鍵入的內容相關的運算全部在閣下的系統中完成。本頁面不會將包括待標註的文本、標註結果在內的任何資料傳送至任何伺服器。</p>\n<h2>閣下的其他資料</h2>\n<p>本頁面使用的內容託管於以下站點：GitHub Pages、jsDelivr、Google Fonts、cdnjs。在閣下訪問本頁面時，閣下的瀏覽器將與這些站點交互。本頁面的開發者並不能讀取閣下訪問這些站點時產生的資料，亦無法控制這些站點如何使用閣下訪問時產生的資料。</p>\n</div>')}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("schemaInput");schemaInputArea=CodeMirror(e,{mode:"javascript",lineNumbers:!0});handleLoadSchema(document.forms.schemaSelect.schema.value)}));
//# sourceMappingURL=index.min.js.map